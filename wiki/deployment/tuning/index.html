<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.3f8e51e9a0fd3d050a3d.css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}body{margin:0;font-family:Roboto,sans-serif;line-height:1.5;font-size:16px}code,pre,tt{font-family:Menlo,Consolas,Monaco,Liberation Mono,Lucida Console,monospace}pre{white-space:pre-wrap}code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#8292a2}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.24.62"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/google-fonts/s/roboto/v20/KFOjCnqEu92Fr1Mu51TzBic6CsQ.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/google-fonts/s/roboto/v20/KFOkCnqEu92Fr1Mu51xIIzI.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/google-fonts/s/roboto/v20/KFOlCnqEu92Fr1MmWUlfBBc4.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/google-fonts/s/roboto/v20/KFOmCnqEu92Fr1Mu4mxK.woff2"/><style type="text/css">@font-face{font-family:Roboto;font-style:italic;font-weight:400;src:local('Roboto Italic'),local('Roboto-Italic'),url(/google-fonts/s/roboto/v20/KFOkCnqEu92Fr1Mu51xIIzI.woff2) format('woff2'),url(/google-fonts/s/roboto/v20/KFOkCnqEu92Fr1Mu51xIIzQ.woff) format('woff');font-display: swap;}@font-face{font-family:Roboto;font-style:italic;font-weight:700;src:local('Roboto Bold Italic'),local('Roboto-BoldItalic'),url(/google-fonts/s/roboto/v20/KFOjCnqEu92Fr1Mu51TzBic6CsQ.woff2) format('woff2'),url(/google-fonts/s/roboto/v20/KFOjCnqEu92Fr1Mu51TzBic6CsI.woff) format('woff');font-display: swap;}@font-face{font-family:Roboto;font-style:normal;font-weight:400;src:local('Roboto'),local('Roboto-Regular'),url(/google-fonts/s/roboto/v20/KFOmCnqEu92Fr1Mu4mxK.woff2) format('woff2'),url(/google-fonts/s/roboto/v20/KFOmCnqEu92Fr1Mu4mxM.woff) format('woff');font-display: swap;}@font-face{font-family:Roboto;font-style:normal;font-weight:700;src:local('Roboto Bold'),local('Roboto-Bold'),url(/google-fonts/s/roboto/v20/KFOlCnqEu92Fr1MmWUlfBBc4.woff2) format('woff2'),url(/google-fonts/s/roboto/v20/KFOlCnqEu92Fr1MmWUlfBBc-.woff) format('woff');font-display: swap;}</style><title data-react-helmet="true">Tuning Velocity | Velocity</title><meta data-react-helmet="true" name="description" content="Velocity comes with good performance out of the box, but there are ways to improve
the performance further. Host your servers on x86-6…"/><meta data-react-helmet="true" property="og:title" content="Tuning Velocity"/><meta data-react-helmet="true" property="og:description" content="Velocity comes with good performance out of the box, but there are ways to improve
the performance further. Host your servers on x86-6…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Velocity Contributors"/><meta data-react-helmet="true" name="twitter:title" content="Tuning Velocity"/><meta data-react-helmet="true" name="twitter:description" content="Velocity comes with good performance out of the box, but there are ways to improve
the performance further. Host your servers on x86-6…"/><style>
        html {
         --background: #121212;
         --foreground: #eee;
         --jumbotron: #222;
         --navbg-border: #212426;
         --sidebar-background: #121212;
         --navbar-background: #121212;
         --navbar-text: #eee;
         --primary: #29b6f6;
         --gray: #e1e1e1;
         --table-background: #323232;
        }
    </style><link as="script" rel="preload" href="/webpack-runtime-24f6b0b1c2971576cd07.js"/><link as="script" rel="preload" href="/styles-fa79fef4936efa84b233.js"/><link as="script" rel="preload" href="/framework-24894821fca4c6ccc1ce.js"/><link as="script" rel="preload" href="/5e2a4920-17c35f5047a7bf4f0cf7.js"/><link as="script" rel="preload" href="/app-783fef7304a0b06884b2.js"/><link as="script" rel="preload" href="/commons-b6092e328a9d0da0fcd8.js"/><link as="script" rel="preload" href="/component---src-templates-wiki-js-53905745950f2fb6af57.js"/><link as="fetch" rel="preload" href="/page-data/wiki/deployment/tuning/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/63159454.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><script>
(function() {
  const themes = JSON.parse('{"dark":{"logoVariant":"white","tableBackground":"#323232","titleButton":"white","skipMobileNavbarBorders":false,"colors":{"background":"#121212","foreground":"#eee","jumbotron":"#222","navbgBorder":"#212426","sidebarBackground":"#121212","navbarBg":"#121212","navbarText":"#eee","primary":"#29b6f6","gray":"#e1e1e1"}},"light":{"logoVariant":"blue","tableBackground":"#e1e1e1","titleButton":"black","skipMobileNavbarBorders":true,"colors":{"background":"#fff","foreground":"#121212","jumbotron":"#ebebeb","navbgBorder":"#d9dcde","sidebarBackground":"#fff","navbarBg":"#121212","navbarText":"#eee","primary":"#0288d1","gray":"#e1e1e1"}}}');

  function setupThemeProperties(theme){const root=document.documentElement;root.style.setProperty('--background',theme.colors.background);root.style.setProperty('--foreground',theme.colors.foreground);root.style.setProperty('--jumbotron',theme.colors.jumbotron);root.style.setProperty('--navbg-border',theme.colors.navbgBorder);root.style.setProperty('--sidebar-background',theme.colors.sidebarBackground);root.style.setProperty('--navbar-background',theme.colors.navbarBg);root.style.setProperty('--navbar-text',theme.colors.navbarText);root.style.setProperty('--primary',theme.colors.primary);root.style.setProperty('--gray',theme.colors.gray);root.style.setProperty('--table-background',theme.tableBackground);}

  function getInitialColorMode() {
    const persistedColorPreference = window.localStorage.getItem('__velocity_preferred_theme');
    const hasPersistedPreference = typeof persistedColorPreference === 'string';
    if (hasPersistedPreference) {
      return persistedColorPreference;
    }
    const mql = window.matchMedia('(prefers-color-scheme: dark)');
    const hasMediaQueryPreference = typeof mql.matches === 'boolean';
    if (hasMediaQueryPreference) {
      return mql.matches ? 'dark' : 'light';
    }
    // Our default look is a dark look
    return 'dark';
  }
  const colorMode = getInitialColorMode();
  const preferredTheme = themes[colorMode];
  
  setupThemeProperties(preferredTheme);
  document.documentElement.style.setProperty('--initial-color-mode', colorMode);
})()</script><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="mjm8nv">.css-mjm8nv{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:auto;}@media (max-width:768px){.css-mjm8nv{-webkit-flex-direction:column-reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse;}}@media (min-width:480px){.css-mjm8nv{margin-bottom:60px;}}</style><article class="css-mjm8nv em2qb6j0"><style data-emotion-css="1sz41db">@media (min-width:768px){.css-1sz41db{position:fixed;bottom:0;top:60px;height:calc(100vh - 9rem);width:12rem;background:var(--sidebar-background);border-right:1px solid var(--navbg-order);padding:1rem;}}@media (min-width:1024px){.css-1sz41db{width:18rem;}}</style><section class="css-1sz41db e1f3copk0"><div><style data-emotion-css="xus3e3">.css-xus3e3{text-transform:uppercase;font-weight:bold;font-size:0.85rem;margin-bottom:1rem;}</style><div class="css-xus3e3 e1f3copk1">Velocity User&#x27;s Guide</div><ul><li><a href="/wiki/users/getting-started/">Getting Started</a></li><li><a href="/wiki/users/built-in-commands/">Built-In Commands</a></li><li><a href="/wiki/users/configuration/">Configuring Velocity</a></li><li><a href="/wiki/users/server-compatibility/">Server Compatibility</a></li><li><a href="/wiki/users/forwarding/">Player Information Forwarding</a></li></ul></div><div><div class="css-xus3e3 e1f3copk1">Deployment Guide</div><ul><li><a href="/wiki/deployment/security/">Securing Your Servers</a></li><li><a aria-current="page" class="" href="/wiki/deployment/tuning/">Tuning Velocity</a></li></ul></div><div><div class="css-xus3e3 e1f3copk1">Developer Guide</div><ul><li><a href="/wiki/developers/creating-your-first-plugin/">Creating Your First Plugin</a></li><li><a href="/wiki/developers/api-basics/">API Basics</a></li><li><a href="/wiki/developers/listener/">The Event API</a></li><li><a href="/wiki/developers/command-api/">The Command API</a></li><li><a href="/wiki/developers/dependencies/">Plugin Dependencies</a></li><li><a href="/wiki/developers/task-scheduling/">Task Scheduling</a></li><li><a href="/wiki/developers/pitfalls/">Common Pitfalls</a></li></ul></div><div><div class="css-xus3e3 e1f3copk1">Technical Wiki</div><ul><li><a href="/wiki/technical/why-not-fork-bungeecord/">Why Not Fork BungeeCord?</a></li></ul></div></section><style data-emotion-css="u3lagp">.css-u3lagp{margin:0 1rem;width:auto;}@media (min-width:768px){.css-u3lagp{margin-left:15rem;margin-right:1rem;width:calc(100vw - 16rem);}}@media (min-width:1024px){.css-u3lagp{margin-left:20rem;margin-right:0;width:calc(100vw - 20rem);}}</style><div class="css-u3lagp em2qb6j1"><style data-emotion-css="17q09oh">.css-17q09oh{max-width:40rem;margin:0 auto;}</style><section class="css-17q09oh em2qb6j2"><h1>Tuning Velocity</h1><p>Velocity comes with good performance out of the box, but there are ways to improve
the performance further.</p><h2>Host your servers on x86-64 Linux</h2><p>Velocity comes with high-performance, specially tuned native libraries for compression and
encryption, along with including native transports from Netty. However, due to support
constraints, the compiled natives are only verified to work on Linux x86-64 and aarch64.
While Velocity will operate normally without the high-performance natives, it will suffer
from degraded performance. For this reason, we strongly recommend that all production deployments
of Velocity run on x86-64 Linux.</p><p>It is possible for the natives to work on any other Unix-like operating system, and in theory
it is also possible to port the natives to Windows, but given that most users deploy Velocity on
Linux, it is unlikely the natives will be supported on any other platform.</p><p>aarch64 support is a special case. It is forward-looking, but current aarch64 offerings are not yet
high-performance, server-grade solutions suitable for Minecraft.</p><h2>Allocate server resources appropriately</h2><p>You should always make sure to allocate the correct amount of heap, network bandwidth, and get the right
CPU for the amount of players you want to have on your proxy at a given time. For instance, it is
unlikely you&#x27;ll be able to get 1,000 players on a Raspberry Pi Zero, but you&#x27;ll have a much better
chance if you have a recent high-end server CPU from Intel or AMD.</p><p>There is no &quot;one-size-fits-all&quot; hardware recommendation, only general guidelines for the amount of players
you can expect. Those guidelines are:</p><ul><li>Prefer lots of cores but lower clock speeds. Unlike the Minecraft server, Velocity can actually benefit
from the extra cores and single-threaded performance is not as important.</li><li>The amount of memory is not as important. You will obviously need memory, but you&#x27;re not going to need a
lot of it. 16GB of physical memory should be sufficient even for large setups that intend to handle in
excess of 1,000 players.</li><li>Disk speed is unimportant. A solid-state drive is nice to have but not strictly required. Likewise, disk
capacity is unimportant as well.</li></ul><h2>Allocate enough heap</h2><p>Alongside having enough CPU, memory, and network bandwidth, you must also allocate enough
Java heap to the proxy. Not doing this can induce lag and in severe cases may result in the proxy
being terminated by the Java Virtual Machine because it ran out of memory.</p><h3>General recommendation</h3><p>The general rule of thumb is that you allocate 512MB per 500 players, plus some extra to allow
for some room for error (typically 1GB extra). For instance, if you want to handle 1,000 on a single
proxy, plan to allocate 2GB of heap.</p><h3>Special notes for containers</h3><p><strong>If you use a containerized setup (such as using Kubernetes, Pterodactyl, or Docker directly),
you should not allocate the entirety of your memory allocation to the heap!</strong> Doing so <em>will</em>
likely cause the proxy to be killed by the kernel&#x27;s out-of-memory killer, which will result in
your proxy going down, likely at the worst possible time.</p><p>A safe (albeit conservative) setting for the heap would be to allocate half of the memory you
allocate to the proxy container in total. For instance, if you know the proxy will need to hold
1,000 players, then allocate 4GB to the container and give the proxy 2GB of heap.</p><h2>Tune your startup flags</h2><p>We also recommend tuning your startup flags. The current recommendation is:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">-XX:+UseG1GC -XX:G1HeapRegionSize=4M -XX:+UnlockExperimentalVMOptions -XX:+ParallelRefProcEnabled -XX:+AlwaysPreTouch -XX:MaxInlineLevel=15</code></pre></div><p>You will add these flags after the <code class="language-text">java</code> command but before the <code class="language-text">-jar</code> parameter.</p><h3>Explanation of the flags</h3><p>Before the release of Java 9, the default Java garbage collector was the Parallel GC. This
is a stop-the-world collector that does its work in parallel. The problem is that its pause
times tend to be long, and are not suitable for Minecraft (often showing up as seemingly
unexplainable lag spikes).</p><p>The recommended garbage collector for Velocity is the G1 region-based collector. There are
several reasons for us to recommend G1:</p><ul><li>It strikes the right balance between throughput and pause times.</li><li>It is compatible with most setups.</li></ul><p>The other flag is <code class="language-text">-XX:MaxInlineLevel=15</code>. This tells the HotSpot native code compilers
(called C1 and C2) how deep they should consider inlining code. Since Velocity&#x27;s pipeline
tends to have somewhat deep stacks, this flag will improve performance slightly through
more aggressive inlining.</p></section></div></article></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/wiki/deployment/tuning/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-8e61bd70da3c6ee3e602.js"],"app":["/app-783fef7304a0b06884b2.js"],"component---src-pages-index-js":["/component---src-pages-index-js-284398e31f2c4d899c59.js"],"component---src-pages-sponsors-js":["/component---src-pages-sponsors-js-04a850985056377d3429.js"],"component---src-templates-wiki-js":["/component---src-templates-wiki-js-53905745950f2fb6af57.js"]};/*]]>*/</script><script src="/polyfill-8e61bd70da3c6ee3e602.js" nomodule=""></script><script src="/component---src-templates-wiki-js-53905745950f2fb6af57.js" async=""></script><script src="/commons-b6092e328a9d0da0fcd8.js" async=""></script><script src="/app-783fef7304a0b06884b2.js" async=""></script><script src="/5e2a4920-17c35f5047a7bf4f0cf7.js" async=""></script><script src="/framework-24894821fca4c6ccc1ce.js" async=""></script><script src="/styles-fa79fef4936efa84b233.js" async=""></script><script src="/webpack-runtime-24f6b0b1c2971576cd07.js" async=""></script></body></html>