{"componentChunkName":"component---src-templates-wiki-js","path":"/wiki/developers/task-scheduling/","result":{"data":{"markdownRemark":{"html":"<p>The Velocity Scheduler lets you decide when and how your plugin tasks run, allowing fine control over execution.\nOn Velocity, there is no main thread. All tasks run using the Velocity Scheduler are thus async.</p>\n<h3>Running a delayed task</h3>\n<p>All scheduling works by using a <code class=\"language-text\">TaskBuilder</code> returned from the <code class=\"language-text\">Scheduler</code>. This fluent builder may be chained to configure\nthe details of the scheduling.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">server<span class=\"token punctuation\">.</span><span class=\"token function\">getScheduler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">buildTask</span><span class=\"token punctuation\">(</span>plugin<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// do stuff here</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">2L</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">.</span>SECONDS<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">schedule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Here, we are scheduling a task to run 2 seconds later. Velocity requires the instance of your plugin, <code class=\"language-text\">plugin</code> above. If you are\nscheduling a task from your main plugin class you may simply use <code class=\"language-text\">this</code>.</p>\n<p>Time arguments are specified as a <code class=\"language-text\">long</code> with a <code class=\"language-text\">java.util.concurrent.TimeUnit</code>. Using time units makes scheduling delayed tasks more readable and allows for greater precision. <code class=\"language-text\">2L, TimeUnit.SECONDS</code> is far easier to understand than the ambiguous <code class=\"language-text\">2000L</code>.</p>\n<h3>Running a repeating task</h3>\n<p>Creating a repeating task is similar to a delayed task, but you must also specify <code class=\"language-text\">repeat(long, TimeUnit)</code>.\nThis example will repeat every 5 minutes.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">server<span class=\"token punctuation\">.</span><span class=\"token function\">getScheduler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">buildTask</span><span class=\"token punctuation\">(</span>plugin<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// do stuff here</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">repeat</span><span class=\"token punctuation\">(</span><span class=\"token number\">5L</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">.</span>MINUTES<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">schedule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Running a task now</h3>\n<p>Tasks use the scheduler's cached thread pool for all execution, which reuses threads. To take advantage of this thread pool\nfor running async tasks which run now, simply omit calling the <em>delay</em> and <em>repeat</em> methods of the TaskBuilder.</p>\n<h3>Cancellation</h3>\n<p>The <code class=\"language-text\">schedule()</code> method returns a <code class=\"language-text\">ScheduledTask</code>, which may then be used to cancel the task involved via the <code class=\"language-text\">cancel()</code> method. Tasks cannot be uncancelled.</p>\n<p>Additionally, <code class=\"language-text\">task.status()</code> returns the current status of the task.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">ScheduledTask</span> task <span class=\"token operator\">=</span> server<span class=\"token punctuation\">.</span><span class=\"token function\">getScheduler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">buildTask</span><span class=\"token punctuation\">(</span>plugin<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// do stuff here</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">repeat</span><span class=\"token punctuation\">(</span><span class=\"token number\">5L</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">.</span>MINUTES<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">schedule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ...</span>\ntask<span class=\"token punctuation\">.</span><span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ...</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>task<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>","frontmatter":{"title":"Using the Scheduler"},"excerpt":"The Velocity Scheduler lets you decide when and how your plugin tasks run, allowing fine control over execution.\nOn Velocity, there is noâ€¦"}},"pageContext":{"slug":"/developers/task-scheduling/"}}}